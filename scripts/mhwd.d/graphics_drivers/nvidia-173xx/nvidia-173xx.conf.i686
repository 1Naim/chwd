# mhwd Driver Config

INCLUDE="translatedtext"

NAME="nvidia-173xx"
FREEDRIVER="false"
PREFEROVER="xf86-video-vesa"
DEPENDS="!nvidia-173xx-utils nvidia-173xx"
CHECKDEPENDS="nvidia-173xx"
CONFLICTS="catalyst nvidia ${freedrivers}"

XORGDEVICEDRIVER="nvidia"

CLASSID="0300"
VENDORIDS="10de"
DEVICEIDS="0040 0041 0042 0043 0044 0045 0046 0047 0048 004e 0090 0091 0092 0093 0095 0098 0099 009c 009d 00c0 00c1 00c2 00c3 00c8 00c9 00cc 00cd 00ce 00f0 00f1 00f2 00f3 00f4 00f5 00f6 00f8 00f9 00fa 00fb 00fc 00fd 00fe 00ff 0140 0141 0142 0143 0144 0145 0146 0147 0148 0149 014a 014c 014d 014e 014f 0160 0161 0162 0163 0164 0165 0166 0167 0168 0169 016a 016b 016c 016d 0191 0193 0194 0197 019d 019e 01d0 01d1 01d2 01d3 01d4 01d6 01d7 01d8 01d9 01da 01db 01dc 01dd 01de 01df 0211 0212 0215 0218 0220 0221 0222 0228 0240 0241 0242 0243 0244 0245 0246 0247 0248 0249 024a 024b 024c 024d 024e 024f 0290 0291 0292 0293 0294 0295 0297 0298 0299 029a 029b 029c 029d 029e 029f 02e0 02e1 02e2 02e3 02e4 0301 0302 0308 0309 0311 0312 0313 0314 0316 0317 031a 031b 031c 031d 031e 031f 0320 0321 0322 0323 0324 0325 0326 0327 0328 0329 032a 032b 032c 032d 032f 0330 0331 0332 0333 0334 0338 033f 0341 0342 0343 0344 0345 0347 0348 0349 034b 034c 034e 034f 0390 0391 0392 0393 0394 0395 0397 0398 0399 039a 039b 039c 039e 03d0 03d1 03d2 03d3 03d4 03d5 03d6 03d7 03d8 03d9 03da 03db 03dc 03dd 03de 03df 0400 0401 0402 0403 0404 0405 0406 0407 0408 0409 040a 040b 040c 040d 040e 040f 0420 0421 0422 0423 0424 0425 0426 0427 0428 0429 042a 042b 042c 042d 042e 042f 0530 0531 0532 0533 053a 053b 053e 053f 0600 0601 0602 0603 0604 0605 0606 0607 0608 0609 060a 060b 060c 060d 060f 0610 0611 0612 0618 0619 061a 061b 061c 061d 061e 0620 0621 0622 0623 0624 0625 0626 0627 0628 0629 062a 062b 062c 062d 062e 062f 0630 0631 0632 0633 0634 0635 0636 0637 0638 0639 063a 063b 063c 063d 063e 063f 0640 0641 0642 0643 0644 0647 0648 0649 064a 064b 064c 0650 0658 0659 065a 065c 06e0 06e1 06e2 06e3 06e4 06e5 06e8 06e9 06ea 06eb 06f0 06f8 06fa 06fb 06ff 07e0 07e1 07e2 07e3 07e4 07e5 07e6 07e7 07e8 07e9 07ea 07eb 07ec 07ed 07ee 07ef 0840 0841 0842 0844 0845 0848 0849 084a 084b 084c 084d 084f 0850 0851 0852 0853 0854 0855 0856 0857 0858 0859 085a 085b 085c 085d 085e 085f 0860 0862 0863 0864 0865 0866 0867 0868 086a 086b 086c 086d 086e 086f 0870 087a 087b 087f"



default()
{
	nvidia-xconfig -o "$1" --composite &>/dev/null
	mhwd_add_Backspace
	mhwd_add_Compositing

	#Load module if X is not running
	if [ ! "$(pidof X)" ];	then
		mhwd_load_Module nvidia
	fi
}


fix_screen_flickering()
{
	sed -i /'Section "Device"'/,/'EndSection'/s/'EndSection'/"\tOption \"NoLogo\" \"1\"\n\tOption \"RegistryDwords\" \"PowerMizerEnable=0x1; PerfLevelSrc=0x2222; PowerMizerDefault=0x2; PowerMizerDefaultAC=0x1\"\nEndSection"/g "$1"
}


add_configure_hook default default
add_configure_hook "id0400 id0401 id0402 id0403 id0407 id0409 id0425" "default fix_screen_flickering"

